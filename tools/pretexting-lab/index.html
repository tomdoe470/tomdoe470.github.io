<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretexting Defense Lab | Ultimate</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg-deep: #020617;
            --bg-panel: #0f172a;
            --bg-element: #1e293b;
            --primary: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #f43f5e;
            --accent-gold: #f59e0b;
            --accent-purple: #a855f7;
            --accent-teal: #14b8a6;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            --border: 1px solid rgba(148, 163, 184, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* --- NAVIGATION --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 40px; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(10px);
            border-bottom: var(--border); z-index: 100;
        }
        .logo { font-family: var(--font-code); font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 12px; }
        .nav-links button {
            background: transparent; border: none; color: var(--text-muted); margin-left: 25px;
            font-family: var(--font-code); font-size: 0.85rem; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .nav-links button:hover, .nav-links button.active { color: var(--primary); text-shadow: 0 0 10px rgba(59, 130, 246, 0.4); }
        .btn-launch {
            background: linear-gradient(135deg, var(--accent-green), #059669); color: #022c22 !important;
            padding: 8px 20px; border-radius: 4px; font-weight: 700 !important; box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        /* --- VIEWS --- */
        .view { display: none; height: 100%; overflow-y: auto; position: relative; }
        .view.active { display: flex; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HOME VIEW --- */
        #home-view { flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        canvas { position: absolute; top: 0; left: 0; z-index: -1; opacity: 0.15; }
        .hero-badge { font-family: var(--font-code); font-size: 0.75rem; color: var(--accent-green); border: 1px solid var(--accent-green); padding: 6px 12px; border-radius: 20px; margin-bottom: 25px; background: rgba(16, 185, 129, 0.05); }
        .hero-title { font-size: 4.5rem; font-weight: 800; line-height: 1.1; letter-spacing: -2px; margin-bottom: 20px; text-transform: uppercase;}
        .hero-title span { background: linear-gradient(to right, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-desc { color: var(--text-muted); font-size: 1.1rem; max-width: 600px; margin: 0 auto 40px; line-height: 1.6; }
        .btn-hero { padding: 14px 32px; border-radius: 6px; font-family: var(--font-code); font-weight: 700; cursor: pointer; border: none; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); }
        .btn-secondary { background: transparent; border: 1px solid var(--text-muted); color: var(--text-main); margin-right: 20px;}

        /* --- METHODOLOGIES --- */
        #methodologies-view { flex-direction: column; padding: 60px; align-items: center; }
        .cards-grid { display: flex; gap: 30px; justify-content: center; flex-wrap: wrap; max-width: 1200px; }
        .flip-card { background-color: transparent; width: 300px; height: 380px; perspective: 1000px; cursor: pointer; margin-bottom: 20px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 16px; padding: 25px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.05); }
        
        /* Card Colors */
        .style-auth .flip-card-front { background: linear-gradient(145deg, #1e3a8a, #172554); }
        .style-urge .flip-card-front { background: linear-gradient(145deg, #7f1d1d, #450a0a); }
        .style-trust .flip-card-front { background: linear-gradient(145deg, #064e3b, #022c22); }
        .style-curiosity .flip-card-front { background: linear-gradient(145deg, #581c87, #3b0764); }
        .style-scarcity .flip-card-front { background: linear-gradient(145deg, #78350f, #451a03); }
        .style-quid .flip-card-front { background: linear-gradient(145deg, #0f766e, #115e59); }

        .flip-card-back { background: var(--bg-element); transform: rotateY(180deg); align-items: flex-start; text-align: left; }
        .flip-card-back h4 { color: var(--primary); font-family: var(--font-code); margin-bottom: 15px; text-transform: uppercase; font-size: 0.9rem; }
        .card-icon-circle { font-size: 2.5rem; margin-bottom: 20px; }
        .example-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border-left: 3px solid var(--text-muted); margin-top: 20px; font-family: var(--font-code); font-size: 0.75rem; color: #e2e8f0; }

        /* --- SIMULATOR LAYOUT --- */
        #simulator-view { padding: 0; height: calc(100vh - 70px); display: none; }
        #simulator-view.active { display: flex; }

        .sim-sidebar { width: 380px; background: var(--bg-panel); border-right: var(--border); padding: 30px; display: flex; flex-direction: column; gap: 20px; z-index: 10; }
        
        /* Tabs */
        .sim-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; }
        .sim-tab { flex: 1; padding: 10px; text-align: center; font-family: var(--font-code); font-size: 0.8rem; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
        .sim-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 700; }

        /* Lists */
        .sc-list { display: none; flex-direction: column; gap: 10px; }
        .sc-list.visible { display: flex; }

        .scenario-item { padding: 15px; border-radius: 8px; background: rgba(255,255,255,0.03); cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .scenario-item:hover { background: rgba(255,255,255,0.05); }
        .scenario-item.active { background: rgba(59, 130, 246, 0.1); border-color: var(--primary); box-shadow: 0 0 10px rgba(59,130,246,0.1); }
        .sc-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-family: var(--font-code); }
        .badge-easy { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .badge-med { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
        .badge-hard { background: rgba(244, 63, 94, 0.2); color: var(--accent-red); }
        .badge-adv { background: rgba(245, 158, 11, 0.2); color: var(--accent-gold); border: 1px solid var(--accent-gold); }

        /* Control Panels */
        .control-panel { margin-top: auto; padding: 20px; background: #020617; border-radius: 12px; border: var(--border); display: none; }
        .control-panel.visible { display: block; }
        
        select { width: 100%; background: var(--bg-element); color: white; padding: 12px; border: var(--border); border-radius: 6px; margin: 15px 0; }
        .verdict-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .btn-verdict { padding: 15px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-family: var(--font-code); color: #020617; transition: 0.2s; }
        .btn-legit { background: var(--accent-green); }
        .btn-mal { background: var(--accent-red); }
        .btn-legit:hover, .btn-mal:hover { filter: brightness(1.1); transform: scale(1.02); }

        /* Viewport */
        .sim-viewport { flex: 1; background: #000; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; display: flex; align-items: center; justify-content: center; padding: 40px; position: relative; }

        /* Windows */
        .os-window { width: 100%; max-width: 700px; background: var(--bg-element); border-radius: 10px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1); overflow: hidden; display: none; animation: popIn 0.4s; }
        .os-window.active { display: block; }
        
        /* Phone Mockup */
        .phone-mockup { width: 320px; height: 650px; background: #000; border-radius: 40px; border: 8px solid #333; position: relative; overflow: hidden; display: none; box-shadow: 0 0 50px rgba(0,0,0,0.8); animation: slideUp 0.5s ease-out; }
        .phone-mockup.active { display: block; }
        .phone-screen { width: 100%; height: 100%; background: #111; position: relative; }
        .phone-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); }
        
        /* Mockup Contents */
        .window-bar { background: #0f172a; padding: 12px 15px; display: flex; align-items: center; gap: 8px; }
        .traffic-light { width: 10px; height: 10px; border-radius: 50%; }
        .tl-red { background: #ef4444; } .tl-yellow { background: #f59e0b; } .tl-green { background: #22c55e; }
        .address-bar { margin-left: 15px; flex: 1; background: #1e293b; color: var(--text-muted); font-size: 0.75rem; padding: 4px 10px; border-radius: 4px; text-align: center; font-family: var(--font-code); }
        
        .sms-popup { position: absolute; top: 40px; left: 10px; right: 10px; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 15px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideDown 0.5s 1s forwards; opacity: 0; transform: translateY(-20px); z-index: 20;}
        @keyframes slideDown { to { opacity: 1; transform: translateY(0); } }
        .call-ui { position: absolute; top: 120px; width: 100%; text-align: center; color: white; z-index: 10; }
        .caller-avatar { width: 80px; height: 80px; background: #94a3b8; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }

        /* --- MODALS & COACHING --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 2000; animation: fadeIn 0.3s; }
        .modal-card { background: var(--bg-element); width: 800px; max-height: 90vh; border-radius: 16px; border: var(--border); overflow-y: auto; box-shadow: 0 20px 50px rgba(0,0,0,0.7); display: none; }
        .modal-header { padding: 20px 30px; border-bottom: var(--border); display: flex; justify-content: space-between; align-items: center; background: var(--bg-panel); }
        .modal-body { padding: 30px; }

        /* Defense Question Items */
        .defense-options { display: flex; flex-direction: column; gap: 15px; }
        .def-btn { padding: 20px; text-align: left; background: var(--bg-deep); border: 1px solid rgba(255,255,255,0.1); color: var(--text-main); border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1rem; display: flex; align-items: center; gap: 15px; }
        .def-btn:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }

        /* Coach Analysis Grid */
        .coach-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .coach-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; }
        .coach-label { color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; display: block; font-weight: 700;}
        
        .toast { position: fixed; top: 30px; right: 30px; background: var(--bg-element); border-left: 4px solid var(--accent-green); padding: 20px 30px; border-radius: 4px; transform: translateX(150%); transition: 0.4s; z-index: 3000; display: flex; align-items: center; gap: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .toast.show { transform: translateX(0); }
        .toast.error { border-left-color: var(--accent-red); }

        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    </style>
</head>
<body>

    <nav>
        <div class="logo"><span style="color: var(--primary)">//</span> PRETEXT_LAB</div>
        <div class="nav-links">
            <button onclick="navTo('home')" class="active">Home</button>
            <button onclick="navTo('methodologies')">Intel</button>
            <button onclick="navTo('simulator')" class="btn-launch">LAUNCH SIM</button>
        </div>
    </nav>

    <div id="home-view" class="view active">
        <canvas id="matrix"></canvas>
        <div style="position: relative; z-index: 2;">
            <div class="hero-badge">v5.0 // ADVANCED WARFARE ACTIVE</div>
            <h1 class="hero-title">DECONSTRUCT THE ART OF<br><span>DECEPTION</span></h1>
            <p class="hero-desc">Interactive training environment. Analyze payloads, identify pretexts, and harden your human firewall against advanced persistent threats.</p>
            <button class="btn-hero btn-primary" onclick="navTo('simulator')">START SIMULATION_</button>
        </div>
    </div>

    <div id="methodologies-view" class="view">
        <div class="section-header" style="text-align: center; margin-bottom: 40px;">
            <h2 style="font-size: 2.5rem;">Core Pretexting Vectors</h2>
        </div>
        <div class="cards-grid">
            <div class="flip-card style-auth" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">üëÆ‚Äç‚ôÇÔ∏è</div><h3>Authority</h3><p>Impersonating executives or legal entities.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>Targets comply with superiors to avoid insubordination.</p></div></div></div>
            <div class="flip-card style-urge" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">üß®</div><h3>Urgency</h3><p>Demanding immediate action.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>Fear induces cognitive tunneling and suspends critical thinking.</p></div></div></div>
            <div class="flip-card style-trust" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">ü§ù</div><h3>Trust</h3><p>Leveraging OSINT for rapport.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>Familiarity lowers natural defenses.</p></div></div></div>
            <div class="flip-card style-curiosity" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">üßê</div><h3>Curiosity</h3><p>Enticing with hidden information.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>Desire to know the unknown triggers clicks.</p></div></div></div>
            <div class="flip-card style-scarcity" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">üíé</div><h3>Scarcity</h3><p>Creating limited availability.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>FOMO drives impulsive action.</p></div></div></div>
            <div class="flip-card style-quid" onclick="this.classList.toggle('flipped')"><div class="flip-card-inner"><div class="flip-card-front"><div class="card-icon-circle">üéÅ</div><h3>Quid Pro Quo</h3><p>Offering a benefit for info.</p></div><div class="flip-card-back"><h4>Analysis</h4><p>Attackers offer help to get credentials.</p></div></div></div>
        </div>
    </div>

    <div id="simulator-view" class="view">
        <aside class="sim-sidebar">
            <div class="sim-tabs">
                <div class="sim-tab active" onclick="switchTab('basic')">BASIC TRAINING</div>
                <div class="sim-tab" onclick="switchTab('advanced')">ADVANCED OPS</div>
            </div>

            <div id="list-basic" class="sc-list visible">
                <div class="scenario-item active" onclick="loadSim('ceo', 'basic')" id="btn-ceo">
                    <div class="sc-header"><span>The 'Urgent' CEO</span><span class="badge badge-med">MEDIUM</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Email payload from high-value target...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('it', 'basic')" id="btn-it">
                    <div class="sc-header"><span>IT Support Reset</span><span class="badge badge-easy">EASY</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Direct message requesting auth tokens...</div>
                </div>
            </div>

            <div id="list-advanced" class="sc-list">
                <div class="scenario-item" onclick="loadSim('gov_ato', 'advanced')" id="btn-gov_ato">
                    <div class="sc-header"><span>Operation: Civic Duty</span><span class="badge badge-adv">ADVANCED</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Multi-channel attack (Voice + SMS)...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('mfa_fatigue', 'advanced')" id="btn-mfa_fatigue">
                    <div class="sc-header"><span>Midnight Storm</span><span class="badge badge-adv">ADVANCED</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">High volume notification request...</div>
                </div>
            </div>

            <div id="panel-analysis" class="control-panel visible">
                <div style="color: var(--primary); font-family: var(--font-code); font-size: 0.8rem; margin-bottom: 10px;">IDENTIFY VECTOR</div>
                <select id="analysis-select">
                    <option value="">-- Select Pretext --</option>
                    <option value="authority">Authority</option>
                    <option value="urgency">Urgency</option>
                    <option value="rapport">Rapport/Trust</option>
                    <option value="quidproquo">Quid Pro Quo</option>
                </select>
                <button class="btn-launch" style="width:100%; border:none; cursor:pointer; margin-top:10px;" onclick="submitBasic()">ANALYZE</button>
            </div>

            <div id="panel-verdict" class="control-panel">
                <div style="color: var(--accent-gold); font-family: var(--font-code); font-size: 0.8rem;">DECISION REQUIRED</div>
                <p style="font-size: 0.9rem; margin: 5px 0;">Is this communication legitimate?</p>
                <div class="verdict-btns">
                    <button class="btn-verdict btn-legit" onclick="submitAdvanced(true)">‚úÖ LEGITIMATE</button>
                    <button class="btn-verdict btn-mal" onclick="submitAdvanced(false)">‚ùå MALICIOUS</button>
                </div>
            </div>
        </aside>

        <main class="sim-viewport">
            <div id="sim-ceo" class="os-window active">
                <div class="window-bar"><div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div><div class="address-bar">üîí mail.corp-internal.net</div></div>
                <div class="email-body">
                    <div style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                        <h3>URGENT: Wire Transfer</h3>
                        <div style="font-size:0.9rem;">From: <span class="sender-tag">e.musk@tesla-motors.com</span></div>
                    </div>
                    <p style="font-family:serif; font-size:1.1rem;">I need you to process an immediate wire transfer of $14,500. Do not discuss this with anyone yet as the deal is under NDA. I'm in a meeting, can't talk.</p>
                </div>
            </div>

            <div id="sim-it" class="os-window">
                <div class="window-bar"><div class="address-bar"># slack-internal</div></div>
                <div class="chat-body">
                    <div class="chat-row"><div class="avatar">ü¶Ñ</div><div class="bubble"><span class="msg-name">SysAdmin</span>We detected a syncing error. Please reply with your 2FA code to resync database.</div></div>
                </div>
            </div>

            <div id="sim-gov_ato" class="phone-mockup">
                <div class="phone-screen">
                    <div class="phone-overlay"></div>
                    <div class="sms-popup">
                        <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#666; margin-bottom:5px;"><span>MESSAGES</span> <span>now</span></div>
                        <div style="font-size:0.9rem;"><strong>WhatsApp:</strong> Your verification code is 449-120. Do not share this with anyone.</div>
                    </div>
                    <div class="call-ui">
                        <div class="caller-avatar">üèõÔ∏è</div>
                        <div style="font-size:1.5rem; font-weight:600;">Ministerio de Salud</div>
                        <div style="opacity:0.8;">Mobile +54 9 11...</div>
                        <p style="margin-top: 30px; font-size: 0.9rem; padding: 0 30px; font-style: italic;">"Hola, le llamamos por su turno de vacunaci√≥n. Le enviamos un c√≥digo SMS para confirmar identidad..."</p>
                        <div style="display: flex; gap: 40px; justify-content: center; margin-top: 60px;">
                            <div style="width: 60px; height: 60px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìû</div>
                            <div style="width: 60px; height: 60px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìû</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sim-mfa_fatigue" class="phone-mockup">
                <div class="phone-screen" style="background-color: #111; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">üîí</div>
                    <h2 style="margin-bottom: 20px; color:white;">Authenticator</h2>
                    <div style="background: #333; padding: 20px; border-radius: 12px; width:80%; margin-bottom: 10px; animation: shake 0.5s; color:white;">
                        <h3>Approve sign-in?</h3>
                        <p style="color: #aaa; font-size: 0.8rem; margin:5px 0 15px 0;">Azure AD ‚Ä¢ California, US</p>
                        <div style="display: flex; gap: 10px;">
                            <button style="flex:1; padding: 10px; background: #444; border:none; color: white; border-radius: 4px;">Deny</button>
                            <button style="flex:1; padding: 10px; background: var(--primary); border:none; color: white; border-radius: 4px;">Approve</button>
                        </div>
                    </div>
                    <div style="background: #333; padding: 20px; border-radius: 12px; width:80%; opacity: 0.5; transform: scale(0.95); color:white;">
                        <h3>Approve sign-in?</h3>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-card" id="modal-defense">
            <div class="modal-header"><h3 style="color: var(--accent-gold)">‚ö†Ô∏è THREAT IDENTIFIED. INITIATE DEFENSE.</h3></div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">You detected the attack. What is your immediate countermeasure?</p>
                <div class="defense-options" id="defense-options-container"></div>
            </div>
        </div>

        <div class="modal-card" id="modal-analysis" style="display:none;">
            <div class="modal-header">
                <h3 style="color: var(--primary)">üõ°Ô∏è MISSION DEBRIEF</h3>
                <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="coach-grid">
                    <div class="coach-box"><span class="coach-label">ATTACK TECHNIQUE (CIALDINI)</span><div id="coach-tech">...</div></div>
                    <div class="coach-box"><span class="coach-label">LINGUISTIC TRIGGERS (VRIJ)</span><div id="coach-ling">...</div></div>
                </div>
                <div class="coach-box" style="margin-top: 20px; border-left: 3px solid var(--accent-green);">
                    <span class="coach-label" style="color: var(--accent-green)">CORRECT DEFENSIVE PROTOCOL</span>
                    <div id="coach-proto">...</div>
                </div>
                <button class="btn-launch" style="width:100%; margin-top:20px; border:none; cursor:pointer;" onclick="closeModal()">RETURN TO LAB</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">
        <div id="toast-icon" style="font-size: 1.5rem;"></div>
        <div><h4 id="toast-title" style="margin:0"></h4><p id="toast-msg" style="font-size:0.8rem; margin:0"></p></div>
    </div>

    <script>
        // --- DATA STRUCTURE (THE BRAIN) ---
        const scenarios = {
            'ceo': {
                correct: ['authority', 'urgency'],
                defenses: [
                    { t: "Reply asking for account details again", c: false },
                    { t: "Call the Executive Assistant on internal line", c: true },
                    { t: "Forward to vendor for verification", c: false }
                ],
                analysis: {
                    tech: "<strong>Authority & Scarcity:</strong> High-pressure request from 'Executive'. Claims to be unavailable to prevent verification.",
                    ling: "<strong>Imperative Language:</strong> 'Process this NOW'. <strong>Isolation:</strong> 'Do not discuss this with anyone'.",
                    proto: "<strong>Verify Out-of-Band:</strong> Never process finance requests via email only. Use a known internal number."
                }
            },
            'it': {
                correct: ['urgency', 'quidproquo'],
                defenses: [
                    { t: "Give code to stop the error", c: false },
                    { t: "Check Ticket ID in portal & report", c: true },
                    { t: "Ignore it", c: false }
                ],
                analysis: {
                    tech: "<strong>Quid Pro Quo:</strong> Offering a service (fixing error) for info (2FA). Exploits fear of lockout.",
                    ling: "<strong>Technobabble:</strong> 'Syncing error', 'Active Directory', 'Resync DB'. Used to overwhelm victim.",
                    proto: "<strong>Zero Trust:</strong> IT Support NEVER asks for passwords or 2FA codes. Report immediately."
                }
            },
            'gov_ato': {
                isMalicious: true, // For Advanced Mode
                defenses: [
                    { t: "Read the code to the caller", c: false },
                    { t: "Hang up immediately", c: true },
                    { t: "Ask for their badge number", c: false }
                ],
                analysis: {
                    tech: "<strong>Authority (Gov) & Urgency:</strong> The 'Vaccine' call is a pretext. The code is for <strong>WhatsApp Registration</strong> (ATO).",
                    ling: "<strong>Context Switching:</strong> Mixing a verbal 'Health' context with a digital 'WhatsApp' notification code.",
                    proto: "<strong>Never Share OTPs:</strong> No legitimate organization asks for a code sent to your phone. It grants account takeover."
                }
            },
            'mfa_fatigue': {
                isMalicious: true, // For Advanced Mode
                defenses: [
                    { t: "Approve to stop the noise", c: false },
                    { t: "Report Account Compromise", c: true },
                    { t: "Turn off phone", c: false }
                ],
                analysis: {
                    tech: "<strong>MFA Fatigue / Exhaustion:</strong> Flooding the victim with prompts hoping they click 'Approve' out of frustration or habit.",
                    ling: "N/A (System Notification). The psychological trigger is <strong>Annoyance</strong> and <strong>Normalization</strong>.",
                    proto: "<strong>Deny & Report:</strong> If you didn't trigger the login, someone has your password. Change it immediately."
                }
            }
        };

        // --- CORE LOGIC ---
        let currentSimId = 'ceo';

        function switchTab(mode) {
            document.querySelectorAll('.sim-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('list-basic').className = mode === 'basic' ? 'sc-list visible' : 'sc-list';
            document.getElementById('list-advanced').className = mode === 'advanced' ? 'sc-list visible' : 'sc-list';
            document.getElementById('panel-analysis').className = mode === 'basic' ? 'control-panel visible' : 'control-panel';
            document.getElementById('panel-verdict').className = mode === 'advanced' ? 'control-panel visible' : 'control-panel';
        }

        function loadSim(id, mode) {
            currentSimId = id;
            document.querySelectorAll('.scenario-item').forEach(i => i.classList.remove('active'));
            document.getElementById('btn-' + id).classList.add('active');
            document.querySelectorAll('.os-window, .phone-mockup').forEach(w => w.classList.remove('active'));
            document.getElementById('sim-' + id).classList.add('active');
        }

        function submitBasic() {
            const val = document.getElementById('analysis-select').value;
            const data = scenarios[currentSimId];
            if (data.correct && data.correct.includes(val)) {
                launchDefensePhase();
            } else {
                showToast("Incorrect Analysis", "error");
            }
        }

        function submitAdvanced(userSaysLegit) {
            const data = scenarios[currentSimId];
            const userSaysMalicious = !userSaysLegit;
            
            if (userSaysMalicious === data.isMalicious) {
                launchDefensePhase();
            } else {
                showToast("Wrong Verdict. System Compromised.", "error");
            }
        }

        function launchDefensePhase() {
            const data = scenarios[currentSimId];
            const container = document.getElementById('defense-options-container');
            container.innerHTML = '';
            
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('modal-defense').style.display = 'block';
            document.getElementById('modal-analysis').style.display = 'none';

            data.defenses.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'def-btn';
                btn.innerHTML = `<span>${opt.t}</span>`;
                btn.onclick = () => {
                    if(opt.c) showCoach(data);
                    else showToast("Defense Failed. Attacker bypassed you.", "error");
                };
                container.appendChild(btn);
            });
        }

        function showCoach(data) {
            document.getElementById('modal-defense').style.display = 'none';
            document.getElementById('modal-analysis').style.display = 'block';
            document.getElementById('coach-tech').innerHTML = data.analysis.tech;
            document.getElementById('coach-ling').innerHTML = data.analysis.ling;
            document.getElementById('coach-proto').innerHTML = data.analysis.proto;
        }

        function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
        function showToast(msg, type) {
            const t = document.getElementById('toast');
            t.className = `toast show ${type}`;
            document.getElementById('toast-title').innerText = type === 'success' ? 'SUCCESS' : 'ALERT';
            document.getElementById('toast-msg').innerText = msg;
            document.getElementById('toast-icon').innerText = type === 'success' ? '‚úÖ' : 'üíÄ';
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        function navTo(id) { 
            document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
            document.getElementById(id+'-view').classList.add('active');
        }

        // Matrix
        const cvs = document.getElementById('matrix'), cx = cvs.getContext('2d');
        function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
        window.onresize = resize; resize();
        const cols = Math.floor(cvs.width/14), ypos = Array(cols).fill(0);
        setInterval(() => {
            cx.fillStyle = '#0001'; cx.fillRect(0,0,cvs.width,cvs.height);
            cx.fillStyle = '#0f0'; cx.font = '14px monospace';
            ypos.forEach((y,i) => {
                cx.fillText(String.fromCharCode(Math.random()*128), i*14, y);
                y > 100 + Math.random()*10000 ? ypos[i]=0 : ypos[i]+=14;
            });
        }, 50);
    </script>
</body>
</html>
