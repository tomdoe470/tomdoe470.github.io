<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretexting Defense Lab | About Me & Ops</title>
    <style>
        /* --- FONTS: Inter for clean UI, JetBrains Mono for Cyber touch --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        :root {
            /* Cyber-Dark Base Palette */
            --bg-deep: #020617;
            --bg-panel: #0f172a;
            --bg-element: #1e293b;
            
            /* State/Action Colors */
            --primary: #3b82f6; /* Electric Blue */
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent-green: #10b981;  /* Terminal Green */
            --accent-red: #f43f5e; /* Alert Red */
            --accent-gold: #f59e0b; /* Scarcity/Greed */
            --accent-purple: #a855f7; /* Curiosity */
            --accent-teal: #14b8a6; /* Quid Pro Quo */
            
            /* NEW: Vibrant Launch Button Color */
            --neon-green: #00ff9d; 

            /* Text */
            --text-main: #f1f5f9;
            --text-muted: #64748b;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;

            /* Borders and Effects */
            --border: 1px solid rgba(148, 163, 184, 0.1);
            --shadow-neon: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* --- NAVIGATION --- */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background: rgba(2, 6, 23, 0.8);
            backdrop-filter: blur(100px);
            border-bottom: var(--border);
            z-index: 100;
        }

        .logo { 
            font-family: var(--font-code);
            font-weight: 700; 
            font-size: 1.1rem; 
            letter-spacing: -0.5px;
            display: flex; 
            align-items: center; 
            gap: 12px;
        }
        
        .nav-links button {
            background: transparent;
            border: none;
            color: var(--text-muted);
            margin-left: 25px;
            font-family: var(--font-code);
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .nav-links button:hover, .nav-links button.active { 
            color: var(--primary);
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }
        
        .btn-launch {
            /* Updated to a more vivid neon green as requested */
            background: var(--neon-green); 
            color: #000 !important; /* Black text for contrast */
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 800 !important;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
            border: 1px solid #00cc7a;
            transition: 0.3s;
        }
        .btn-launch:hover { 
            box-shadow: 0 0 35px rgba(0, 255, 157, 0.6); 
            transform: translateY(-2px) scale(1.05);
            background: #33ffad;
        }

        /* --- VIEWS SYSTEM --- */
        .view { display: none; height: 100%; overflow-y: auto; position: relative; }
        .view.active { display: flex; animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HOME VIEW (Matrix Redesigned) --- */
        #home-view { flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        
        canvas { position: absolute; top: 0; left: 0; z-index: -1; opacity: 0.15; }

        .hero-badge {
            font-family: var(--font-code);
            font-size: 0.75rem;
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
            padding: 6px 12px;
            border-radius: 20px;
            margin-bottom: 25px;
            background: rgba(16, 185, 129, 0.05);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
        }

        .hero-title { font-size: 4.5rem; font-weight: 800; line-height: 1.1; letter-spacing: -2px; margin-bottom: 20px; text-transform: uppercase;}
        .hero-title span { 
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .hero-desc { color: var(--text-muted); font-size: 1.1rem; max-width: 600px; margin: 0 auto 40px; line-height: 1.6; }

        .cta-group { display: flex; gap: 20px; }
        .btn-hero {
            padding: 14px 32px;
            border-radius: 6px;
            font-family: var(--font-code);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .btn-primary {
            background: var(--primary);
            border: none;
            color: white;
            box-shadow: var(--shadow-neon);
        }
        .btn-primary:hover { background: #2563eb; box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-main);
        }
        .btn-secondary:hover { border-color: var(--text-main); background: rgba(255,255,255,0.05); }

        /* --- METHODOLOGIES (Styled Flip Cards) --- */
        #methodologies-view { flex-direction: column; padding: 60px; align-items: center; }
        
        .section-header { text-align: center; margin-bottom: 50px; }
        .section-header h2 { font-size: 2.5rem; margin-bottom: 10px; }
        
        .cards-grid { display: flex; gap: 30px; justify-content: center; flex-wrap: wrap; max-width: 1200px; margin-bottom: 40px;}
        
        .flip-card { background-color: transparent; width: 340px; height: 420px; perspective: 1000px; cursor: pointer; margin-bottom: 20px; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        
        .flip-card-front, .flip-card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            border-radius: 16px; padding: 30px; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Card Colors */
        .style-auth .flip-card-front { background: linear-gradient(145deg, #1e3a8a, #172554); }
        .style-urge .flip-card-front { background: linear-gradient(145deg, #7f1d1d, #450a0a); }
        .style-trust .flip-card-front { background: linear-gradient(145deg, #064e3b, #022c22); }
        .style-curiosity .flip-card-front { background: linear-gradient(145deg, #581c87, #3b0764); }
        .style-scarcity .flip-card-front { background: linear-gradient(145deg, #78350f, #451a03); }
        .style-quid .flip-card-front { background: linear-gradient(145deg, #0f766e, #115e59); }

        .card-icon-circle {
            width: 80px; height: 80px; border-radius: 50%; 
            background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .flip-card h3 { font-family: var(--font-code); font-size: 1.4rem; margin-bottom: 10px; letter-spacing: -0.5px; }
        .reveal-hint { margin-top: auto; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; opacity: 0.7; }

        .flip-card-back { background: var(--bg-element); transform: rotateY(180deg); align-items: flex-start; text-align: left; border: 1px solid rgba(255,255,255,0.1); }
        .flip-card-back h4 { color: var(--primary); font-family: var(--font-code); margin-bottom: 15px; text-transform: uppercase; font-size: 0.9rem; }
        .example-box {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; 
            border-left: 3px solid var(--text-muted); margin-top: 20px;
            font-family: var(--font-code); font-size: 0.8rem; color: #e2e8f0;
        }

        /* --- PROFILE VIEW (ABOUT ME) --- */
        #profile-view {
            padding: 40px;
            justify-content: center;
            align-items: flex-start;
        }
        
        .profile-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 40px;
            max-width: 1300px;
            width: 100%;
            margin: 0 auto;
        }

        /* Profile Left Sidebar */
        .profile-sidebar {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: var(--border);
            border-radius: 16px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: fit-content;
            box-shadow: 0 0 40px rgba(0,0,0,0.3);
            border-left: 2px solid var(--primary);
        }

        .profile-pic-container {
            width: 150px; height: 150px;
            position: relative; margin-bottom: 25px;
        }
        .profile-pic {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            filter: grayscale(100%);
            transition: 0.3s;
        }
        .profile-pic:hover { filter: grayscale(0%); }
        .online-dot {
            position: absolute; bottom: 10px; right: 10px;
            width: 15px; height: 15px; background: var(--accent-green);
            border-radius: 50%; border: 3px solid var(--bg-panel);
            box-shadow: 0 0 10px var(--accent-green);
        }

        .profile-name { font-family: var(--font-code); font-size: 1.8rem; font-weight: 700; letter-spacing: -1px; margin-bottom: 5px; color: white;}
        .profile-role { font-family: var(--font-code); color: var(--text-muted); font-size: 0.9rem; margin-bottom: 30px; letter-spacing: 1px; }

        .profile-stats {
            width: 100%;
            display: flex; flex-direction: column; gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            background: rgba(255,255,255,0.03);
            padding: 15px; border-radius: 8px;
            border: 1px solid transparent;
            cursor: pointer; transition: 0.2s;
        }
        .stat-item:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; font-family: var(--font-code); letter-spacing: 1px; }
        .stat-value { font-size: 1.1rem; color: var(--text-main); font-weight: 600; margin-top: 5px; }

        /* Profile Main Content */
        .profile-content { display: flex; flex-direction: column; gap: 30px; }

        .decrypt-header {
            font-family: var(--font-code);
            font-size: 3rem; font-weight: 800;
            color: var(--text-main);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            margin-bottom: 10px;
            position: relative;
        }
        .decrypt-header::after { content: '_'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .bio-section {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
        }
        .bio-card {
            background: var(--bg-panel); border: var(--border);
            padding: 25px; border-radius: 12px;
            position: relative; overflow: hidden;
        }
        .bio-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: var(--primary);
        }
        .bio-title {
            color: var(--primary); font-family: var(--font-code);
            font-size: 1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;
        }
        
        .vectors-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;
        }
        .skill-card {
            background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.05);
            padding: 20px; border-radius: 8px; transition: 0.3s;
        }
        .skill-card:hover { transform: translateY(-5px); border-color: var(--accent-green); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .skill-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; color: white; font-weight: 600; }
        .tags-container { display: flex; gap: 8px; flex-wrap: wrap; }
        .skill-tag { 
            font-family: var(--font-code); font-size: 0.7rem; 
            padding: 4px 8px; background: rgba(16, 185, 129, 0.1); 
            color: var(--accent-green); border-radius: 4px;
        }

        /* Terminal Contact Form */
        .uplink-terminal {
            background: #050505; border: 1px solid #333;
            border-radius: 10px; padding: 0; overflow: hidden;
            font-family: var(--font-code);
        }
        .terminal-header {
            background: #1a1a1a; padding: 10px 15px; color: #666; font-size: 0.8rem;
            border-bottom: 1px solid #333; display: flex; justify-content: space-between;
        }
        .terminal-body { padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        
        .cmd-line { display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .prompt { color: var(--accent-green); white-space: nowrap; }
        .cmd-input {
            background: transparent; border: none; color: white;
            font-family: var(--font-code); font-size: 0.95rem; width: 100%;
        }
        .btn-transmit {
            background: var(--primary); color: white; border: none;
            padding: 12px; font-family: var(--font-code); font-weight: 700;
            margin-top: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.2s;
        }
        .btn-transmit:hover { background: var(--accent-green); color: #000; }


        /* --- SIMULATOR (Dashboard UI) --- */
        #simulator-view { padding: 0; height: calc(100vh - 70px); display: none; }
        #simulator-view.active { display: flex; }

        /* Left Control Panel */
        .sim-sidebar {
            width: 380px;
            background: var(--bg-panel);
            border-right: var(--border);
            padding: 30px;
            display: flex; flex-direction: column; gap: 20px;
            box-shadow: 5px 0 20px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* --- MERGED TABS FROM CODE 2 --- */
        .sim-tabs { display: flex; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; }
        .sim-tab { flex: 1; padding: 10px; text-align: center; font-family: var(--font-code); font-size: 0.8rem; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
        .sim-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 700; }

        .sc-list { display: none; flex-direction: column; gap: 10px; }
        .sc-list.visible { display: flex; }

        .panel-title { font-family: var(--font-code); font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }

        .scenario-item {
            padding: 15px; border-radius: 8px;
            background: rgba(255,255,255,0.03);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        .scenario-item:hover { background: rgba(255,255,255,0.05); }
        .scenario-item.active {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.1);
        }

        .sc-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: 600; }
        .badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-family: var(--font-code); }
        .badge-easy { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .badge-med { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
        .badge-hard { background: rgba(244, 63, 94, 0.2); color: var(--accent-red); }
        .badge-adv { background: rgba(245, 158, 11, 0.2); color: var(--accent-gold); border: 1px solid var(--accent-gold); }

        .control-panel { display: none; margin-top: auto; padding: 20px; background: #020617; border-radius: 12px; border: var(--border); }
        .control-panel.visible { display: block; }
        
        select {
            width: 100%; background: var(--bg-element);
            color: white; padding: 12px;
            border: var(--border); border-radius: 6px;
            margin: 15px 0; font-family: var(--font-ui);
        }

        /* VERDICT BUTTONS (Advanced Mode) */
        .verdict-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .btn-verdict { padding: 15px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-family: var(--font-code); color: #020617; transition: 0.2s; }
        .btn-legit { background: var(--accent-green); }
        .btn-mal { background: var(--accent-red); }
        .btn-legit:hover, .btn-mal:hover { filter: brightness(1.1); transform: scale(1.02); }

        /* Checklist Styles for New Challenge */
        .checklist-item {
            display: flex; align-items: center; gap: 10px;
            background: rgba(255,255,255,0.05); padding: 10px;
            border-radius: 6px; margin-bottom: 8px; cursor: pointer;
            transition: 0.2s;
        }
        .checklist-item:hover { background: rgba(255,255,255,0.1); }
        .checklist-item.checked { border-left: 3px solid var(--accent-green); background: rgba(16, 185, 129, 0.1); }
        .check-box {
            width: 18px; height: 18px; border: 2px solid var(--text-muted); border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
        }
        .checklist-item.checked .check-box { border-color: var(--accent-green); background: var(--accent-green); color: #000; }
        .btn-switch-view {
            position: absolute; bottom: 20px; right: 20px; z-index: 50;
            background: var(--bg-panel); color: white; border: 1px solid var(--primary);
            padding: 10px 20px; border-radius: 30px; font-family: var(--font-code);
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 10px;
        }
        .btn-switch-view:hover { background: var(--primary); }

        /* Multi-Stage Challenge Styles */
        .timeline-controls {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            z-index: 200; /* FIXED: Increased z-index to be above the overlay */
            background: var(--bg-panel); border-radius: 30px; border: 1px solid var(--primary);
            display: flex; align-items: center; padding: 5px 10px; gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .timeline-dot {
            width: 12px; height: 12px; border-radius: 50%; background: #334155; cursor: pointer; transition: 0.3s;
        }
        .timeline-dot.active { background: var(--primary); box-shadow: 0 0 10px var(--primary); transform: scale(1.2); }
        .btn-timeline {
            background: transparent; border: none; color: white; cursor: pointer; font-size: 1.2rem;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%;
        }
        .btn-timeline:hover { background: rgba(255,255,255,0.1); }

        /* Fake AV Popup */
        .fake-av-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center; z-index: 100; animation: flashRed 2s infinite;
        }
        .fake-av-window {
            width: 500px; background: #fff; color: #000; font-family: 'Segoe UI', sans-serif;
            border: 1px solid #ccc; box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .av-header {
            background: #d13438; color: white; padding: 10px 15px; font-weight: 600; display: flex; align-items: center; gap: 10px;
        }
        @keyframes flashRed { 0%, 100% { box-shadow: inset 0 0 50px rgba(209, 52, 56, 0.2); } 50% { box-shadow: inset 0 0 100px rgba(209, 52, 56, 0.5); } }

        /* Right Viewport */
        .sim-viewport {
            flex: 1; background: #000;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; align-items: center; justify-content: center;
            padding: 40px; position: relative;
        }

        /* Mockup Windows (Code 1 Style) */
        .os-window {
            width: 100%; max-width: 700px;
            background: var(--bg-element);
            border-radius: 10px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden; display: none;
            position: relative; /* FIXED: Added relative positioning */
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .os-window.active { display: block; }

        /* PHONE MOCKUP (Merged from Code 2) */
        .phone-mockup { width: 320px; height: 650px; background: #000; border-radius: 40px; border: 8px solid #333; position: relative; overflow: hidden; display: none; box-shadow: 0 0 50px rgba(0,0,0,0.8); animation: slideUp 0.5s ease-out; }
        .phone-mockup.active { display: block; }
        .phone-screen { width: 100%; height: 100%; background: #111; position: relative; }
        .phone-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); }
        
        .sms-popup { position: absolute; top: 40px; left: 10px; right: 10px; background: rgba(255,255,255,0.95); border-radius: 12px; padding: 15px; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideDown 0.5s 1s forwards; opacity: 0; transform: translateY(-20px); z-index: 20;}
        .call-ui { position: absolute; top: 120px; width: 100%; text-align: center; color: white; z-index: 10; }
        .caller-avatar { width: 80px; height: 80px; background: #94a3b8; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 2rem; }

        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideDown { to { opacity: 1; transform: translateY(0); } }

        .window-bar {
            background: #0f172a; padding: 12px 15px;
            display: flex; align-items: center; gap: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .traffic-light { width: 10px; height: 10px; border-radius: 50%; }
        .tl-red { background: #ef4444; } .tl-yellow { background: #f59e0b; } .tl-green { background: #22c55e; }
        
        .address-bar {
            margin-left: 15px; flex: 1;
            background: #1e293b; color: var(--text-muted);
            font-size: 0.75rem; padding: 4px 10px; border-radius: 4px;
            text-align: center; font-family: var(--font-code);
            display: flex; justify-content: center; align-items: center; gap: 6px;
        }

        /* Content Styles (Email, Chat, etc) */
        .email-body { padding: 40px; background: #ffffff; color: #1e293b; }
        .email-meta { border-bottom: 1px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 20px; }
        .sender-tag { background: #fee2e2; color: #991b1b; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; font-family: var(--font-code); }

        .chat-body { padding: 30px; background: #0f172a; display: flex; flex-direction: column; gap: 20px; }
        .chat-row { display: flex; gap: 15px; }
        .avatar { width: 40px; height: 40px; border-radius: 8px; background: #6366f1; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .bubble { background: #1e293b; padding: 15px; border-radius: 0 12px 12px 12px; color: #e2e8f0; font-size: 0.95rem; line-height: 1.5; border: 1px solid rgba(255,255,255,0.05); }
        .msg-name { color: #818cf8; font-size: 0.75rem; font-weight: 700; margin-bottom: 4px; display: block; }

        .wsp-header { background: #202c33; color: #e9edef; padding: 10px 15px; display: flex; align-items: center; gap: 15px; }
        .wsp-avatar { width: 40px; height: 40px; border-radius: 50%; background: #00a884; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .wsp-body { background: #0b141a; padding: 20px; display: flex; flex-direction: column; gap: 10px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: 300px; }
        .wsp-msg { max-width: 70%; padding: 8px 10px; border-radius: 8px; font-size: 0.9rem; line-height: 1.4; position: relative; }
        .wsp-in { background: #202c33; align-self: flex-start; color: #e9edef; }
        .wsp-out { background: #005c4b; align-self: flex-end; color: #e9edef; }
        .wsp-time { font-size: 0.65rem; color: #8696a0; text-align: right; margin-top: 4px; }

        /* --- COACHING & MODAL SYSTEM --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
            animation: fadeIn 0.3s;
        }
        .modal-card {
            background: var(--bg-element); width: 800px; max-height: 90vh;
            border-radius: 16px; border: var(--border); overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); display: none;
        }
        .modal-header {
            padding: 20px 30px; border-bottom: var(--border); display: flex; justify-content: space-between;
            align-items: center; background: var(--bg-panel);
        }
        .modal-body { padding: 30px; }

        .defense-options { display: flex; flex-direction: column; gap: 15px; }
        .def-btn {
            padding: 20px; text-align: left; background: var(--bg-deep);
            border: 1px solid rgba(255,255,255,0.1); color: var(--text-main);
            border-radius: 8px; cursor: pointer; transition: 0.2s;
            font-size: 1rem; display: flex; align-items: center; gap: 15px;
        }
        .def-btn:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.05); }
        .def-icon { font-size: 1.5rem; }

        .coach-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .coach-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; }
        .coach-label { color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; display: block; font-weight: 700;}
        
        .toast {
            position: fixed; top: 30px; right: 30px;
            background: var(--bg-element); border-left: 4px solid var(--accent-green);
            padding: 20px 30px; border-radius: 4px; box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transform: translateX(150%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 2000; display: flex; align-items: center; gap: 15px;
        }
        .toast.show { transform: translateX(0); }
        .toast.error { border-left-color: var(--accent-red); }

        /* ONBOARDING MODAL STYLES */
        #onboarding-modal {
            display: flex; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: var(--bg-deep);
            z-index: 5000;
        }
        
        .onboarding-content {
            text-align: center;
            width: 100%;
            max-width: 500px;
            animation: fadeIn 1s ease-out;
        }

        .terminal-input-group {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--primary);
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            font-family: var(--font-code);
        }

        .blink-cursor {
            animation: blink 1s step-end infinite;
        }

    </style>
</head>
<body>

    <!-- ONBOARDING MODAL -->
    <div class="modal-overlay" id="onboarding-modal" style="display: flex;">
        <div class="onboarding-content">
            <h1 class="hero-title" style="font-size: 3rem;">SYSTEM<br><span>INITIALIZATION</span></h1>
            <p class="hero-desc">Identity verification required to access operational modules.</p>
            
            <div class="terminal-input-group">
                <span style="color: var(--accent-green); margin-right: 10px;">root@system:~$</span>
                <input type="text" id="username-input" placeholder="Enter Operator Alias..." 
                       style="background: transparent; border: none; color: white; width: 100%; font-family: var(--font-code); font-size: 1.1rem; outline: none;" 
                       autocomplete="off" onkeypress="handleEnter(event)">
                <span class="blink-cursor">_</span>
            </div>

            <button class="btn-hero btn-primary" style="width: 100%; margin-top: 20px;" onclick="completeOnboarding()">ESTABLISH SESSION</button>
        </div>
    </div>

    <nav>
        <div class="logo">
            <span style="color: var(--primary)">//</span> PRETEXT_LAB
        </div>
        <div class="nav-links">
            <button onclick="navTo('home')" class="active">Home</button>
            <button onclick="navTo('methodologies')">Intel</button>
            <button onclick="navTo('profile')">ABOUT ME</button>
            <button onclick="navTo('simulator')" class="btn-launch">LAUNCH SIM</button>
        </div>
    </nav>

    <div id="home-view" class="view active">
        <canvas id="matrix"></canvas>
        <div style="position: relative; z-index: 2;">
            <div class="hero-badge">v3.5 // OPS MODULE ACTIVE</div>
            <h1 class="hero-title">DECONSTRUCT THE ART OF<br><span>DECEPTION</span></h1>
            <p class="hero-desc">Interactive training environment designed to deconstruct social engineering attacks. Analyze payloads, identify pretexts, and harden your human firewall.</p>
            <div class="cta-group">
                <button class="btn-hero btn-secondary" onclick="navTo('methodologies')">VIEW VECTORS</button>
                <button class="btn-hero btn-primary" onclick="navTo('simulator')">START SIMULATION_</button>
            </div>
        </div>
    </div>

    <!-- NEW PROFILE MODULE -->
    <div id="profile-view" class="view">
        <div class="profile-container">
            <aside class="profile-sidebar">
                <div class="profile-pic-container">
                    <img src="https://ui-avatars.com/api/?name=Tom+Doe&background=0f172a&color=3b82f6&size=200" alt="Profile" class="profile-pic">
                    <div class="online-dot"></div>
                </div>
                <h2 class="profile-name">TomDoe</h2>
                <div class="profile-role">PENTESTER & SOCIAL ENGINEER</div>

                <!-- ADDED CONTACT SECTION IN SIDEBAR -->
                <div class="profile-stats">
                    <div style="font-family: var(--font-code); color: var(--accent-green); font-size: 0.8rem; margin-bottom: 10px; letter-spacing: 1px;">> ESTABLISH CONNECTION</div>
                    <a href="https://www.linkedin.com/in/tomas-de-otaduy/" target="_blank" style="text-decoration: none;">
                        <div class="stat-item" style="border-left: 3px solid #0a66c2;">
                            <div class="stat-label" style="color: #0a66c2;">LINKEDIN PROFILE</div>
                            <div class="stat-value" style="font-size: 0.9rem;">tomas-de-otaduy ‚Üó</div>
                        </div>
                    </a>
                </div>
            </aside>

            <main class="profile-content">
                <div>
                    <h1 class="decrypt-header" id="typing-text">DECRYPTING...</h1>
                    <p style="color: var(--text-muted); font-family: var(--font-code);">Initializing... Loading profile</p>
                </div>

                <div class="bio-section">
                    <div class="bio-card">
                        <div class="bio-title"><span style="font-size: 1.2rem;">üìÇ</span> ORIGIN</div>
                        <p style="font-size: 0.9rem; line-height: 1.6; color: #cbd5e1;">Argentinian specializing in information security, forged in the digital revolution. I'm an enthusiast in the psychological aspects of information security and intelligence operations. "Every system is only as strong as the human operating it."</p>
                    </div>
                    <div class="bio-card">
                        <div class="bio-title"><span style="font-size: 1.2rem;">üß¨</span> INTERESTS</div>
                        <p style="font-size: 0.9rem; line-height: 1.6; color: #cbd5e1;">Obsessed with the mechanics of social engineering and the methodology of detection. I also enjoy everything related to web pentesting and intelligence operations based on OSINT.</p>
                    </div>
                </div>

                <div>
                    <h3 style="font-family: var(--font-code); margin-bottom: 20px; color: var(--primary);">OPERATIONAL VECTORS</h3>
                    <div class="vectors-grid">
                        <div class="skill-card">
                            <div class="skill-header">
                                <span style="font-size: 1.5rem;">‚öôÔ∏è</span> SOCIAL ENGINEERING
                            </div>
                            <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 15px;">Crafting sophisticated pretexts and leveraging human psychology to bypass authentication protocols for the purpose of enhancing user training and evaluating security during red-team operations.</p>
                            <div class="tags-container">
                                <span class="skill-tag">[OSINT]</span>
                                <span class="skill-tag">[VISHING]</span>
                                <span class="skill-tag">[PRETEXTING]</span>
                            </div>
                        </div>

                        <div class="skill-card">
                            <div class="skill-header">
                                <span style="font-size: 1.5rem;">üõ°Ô∏è</span> SECURITY & PENTESTING
                            </div>
                            <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 15px;">Identifying vulnerabilities in physical and digital infrastructure. Hardening systems against intrusion.</p>
                            <div class="tags-container">
                                <span class="skill-tag">[OWASP]</span>
                                <span class="skill-tag">[BURP SUITE]</span>
                                <span class="skill-tag">[PYTHON]</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="uplink-terminal">
                    <div class="terminal-header">
                        <span>ESTABLISH UPLINK</span>
                        <span>root@system:~/profile/contact</span>
                    </div>
                    <div class="terminal-body">
                        <div class="cmd-line">
                            <span class="prompt">root@visitor:~$</span>
                            <span style="color: #64748b;">set_sender_id</span>
                        </div>
                        <div class="cmd-line">
                            <span class="prompt">></span>
                            <input type="text" class="cmd-input" placeholder="Enter your name/alias...">
                        </div>
                        
                        <div class="cmd-line" style="margin-top: 10px;">
                            <span class="prompt">root@visitor:~$</span>
                            <span style="color: #64748b;">set_return_path</span>
                        </div>
                        <div class="cmd-line">
                            <span class="prompt">></span>
                            <input type="email" class="cmd-input" placeholder="Enter your email...">
                        </div>

                        <div class="cmd-line" style="margin-top: 10px;">
                            <span class="prompt">root@visitor:~$</span>
                            <span style="color: #64748b;">define_payload</span>
                        </div>
                        <div class="cmd-line">
                            <span class="prompt">></span>
                            <input type="text" class="cmd-input" placeholder="Type your message here...">
                        </div>

                        <button class="btn-transmit">
                            <span>‚ñ∂</span> TRANSMIT DATA PACKET
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="methodologies-view" class="view">
        <div class="section-header">
            <div style="font-family: var(--font-code); color: var(--primary); margin-bottom: 10px;">KNOWLEDGE BASE</div>
            <h2>Core Pretexting Vectors</h2>
        </div>

        <div class="cards-grid">
            <div class="flip-card style-auth" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">üëÆ‚Äç‚ôÇÔ∏è</div>
                        <h3>Authority</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Impersonating executives, legal entities, or sysadmins.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: #60a5fa">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">Targets are conditioned to comply with superiors to avoid insubordination.</p>
                        <div class="example-box" style="border-color: #60a5fa">> "This is the CEO. Wire funds for acquisition Project X immediately."</div>
                    </div>
                </div>
            </div>
            <div class="flip-card style-urge" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">üß®</div>
                        <h3>Urgency</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Demanding immediate action to prevent disaster.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: var(--accent-red)">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">Fear induces cognitive tunneling. When victims believe time is running out, critical thinking is suspended.</p>
                        <div class="example-box" style="border-color: var(--accent-red)">> "Account suspension in 5 min. Verify credentials NOW."</div>
                    </div>
                </div>
            </div>
            <div class="flip-card style-trust" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">ü§ù</div>
                        <h3>Trust & Rapport</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Leveraging OSINT to appear as a friend or colleague.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: var(--accent-green)">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">Building familiarity lowers natural defenses. Attackers mine social media for shared interests.</p>
                        <div class="example-box" style="border-color: var(--accent-green)">> "Loved your Bali pics! Btw, can you send that Q3 sheet?"</div>
                    </div>
                </div>
            </div>
            <div class="flip-card style-curiosity" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">üßê</div>
                        <h3>Curiosity</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Enticing the victim with hidden or forbidden information.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: var(--accent-purple)">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">Humans have an innate desire to know the unknown. Vague filenames trigger clicks.</p>
                        <div class="example-box" style="border-color: var(--accent-purple)">> "Fwd: Layoff_Plan_Q4_FINAL.docx - Do not share"</div>
                    </div>
                </div>
            </div>
            <div class="flip-card style-scarcity" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">üíé</div>
                        <h3>Scarcity</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Creating a false sense of limited availability.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: var(--accent-gold)">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">FOMO drives impulsive action. Offers that seem "too good to be true" usually are.</p>
                        <div class="example-box" style="border-color: var(--accent-gold)">> "Only 2 spots left for the Executive Bonus Program."</div>
                    </div>
                </div>
            </div>
            <div class="flip-card style-quid" onclick="this.classList.toggle('flipped')">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        <div class="card-icon-circle">üéÅ</div>
                        <h3>Quid Pro Quo</h3>
                        <p style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">Offering a benefit or service in exchange for info.</p>
                        <div class="reveal-hint">Click to Decrypt</div>
                    </div>
                    <div class="flip-card-back">
                        <h4 style="color: var(--accent-teal)">Vector Analysis</h4>
                        <p style="font-size: 0.9rem; line-height: 1.6;">"Something for something". Attackers offer help (often technical) to get credentials.</p>
                        <div class="example-box" style="border-color: var(--accent-teal)">> "I can fix that slow network speed, just need your pass."</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="simulator-view" class="view">
        <aside class="sim-sidebar">
            
            <div class="sim-tabs">
                <div class="sim-tab active" onclick="switchTab('basic')">BASIC TRAINING</div>
                <div class="sim-tab" onclick="switchTab('advanced')">ADVANCED OPS</div>
            </div>

            <div id="list-basic" class="sc-list visible">
                <div class="scenario-item active" onclick="loadSim('ceo', 'basic')" id="btn-ceo">
                    <div class="sc-header"><span>The 'Urgent' CEO</span><span class="badge badge-med">MEDIUM</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Email payload from high-value target...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('it', 'basic')" id="btn-it">
                    <div class="sc-header"><span>IT Support Reset</span><span class="badge badge-easy">EASY</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Direct message requesting auth tokens...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('job', 'basic')" id="btn-job">
                    <div class="sc-header"><span>Dream Job Recruiter</span><span class="badge badge-hard">HARD</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">LinkedIn lure with malicious attachment...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('wsp', 'basic')" id="btn-wsp">
                    <div class="sc-header"><span>Vendor Pay Update</span><span class="badge badge-med">MEDIUM</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">WhatsApp msg from known supplier...</div>
                </div>
            </div>

            <div id="list-advanced" class="sc-list">
                <div class="scenario-item" onclick="loadSim('gov_ato', 'advanced')" id="btn-gov_ato">
                    <div class="sc-header"><span>Operation: Civic Duty</span><span class="badge badge-adv">ADVANCED</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Multi-channel attack (Voice + SMS)...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('mfa_fatigue', 'advanced')" id="btn-mfa_fatigue">
                    <div class="sc-header"><span>Midnight Storm</span><span class="badge badge-adv">ADVANCED</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">High volume notification request...</div>
                </div>
                <div class="scenario-item" onclick="loadSim('recruitment', 'advanced')" id="btn-recruitment">
                    <div class="sc-header"><span>Headhunter Verification</span><span class="badge badge-adv">ADVANCED</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Multi-stage Recruitment Ops...</div>
                </div>
                <!-- NEW MULTI-STAGE CHALLENGE -->
                <div class="scenario-item" onclick="loadSim('multistage', 'advanced')" id="btn-multistage">
                    <div class="sc-header"><span>Operation: TechNova</span><span class="badge badge-adv">COMPLEX</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-muted)">Persistent threat chain. 5 Stages.</div>
                </div>
            </div>

            <div class="control-panel visible" id="panel-analysis">
                <div class="panel-title" style="color: var(--primary)">ANALYST CONSOLE</div>
                <p style="font-size: 0.85rem;">Identify the primary psychological lever:</p>
                <select id="analysis-select">
                    <option value="">-- Select Vector --</option>
                    <option value="authority">Abuse of Authority</option>
                    <option value="urgency">False Sense of Urgency</option>
                    <option value="rapport">Fabricated Rapport</option>
                    <option value="curiosity">Curiosity / Mystery</option>
                    <option value="scarcity">Scarcity / Greed</option>
                    <option value="quidproquo">Quid Pro Quo</option>
                    <option value="multivector">Complex / Multi-Vector APT</option>
                </select>
                <button class="btn-hero btn-primary" style="width: 100%; margin-top: 10px;" onclick="submitAnalysis()">SUBMIT REPORT</button>
            </div>

            <div class="control-panel" id="panel-verdict">
                <div id="verdict-buttons-container">
                    <div style="color: var(--accent-gold); font-family: var(--font-code); font-size: 0.8rem;">DECISION REQUIRED</div>
                    <p style="font-size: 0.9rem; margin: 5px 0;">Is this communication legitimate?</p>
                    <div class="verdict-btns">
                        <button class="btn-verdict btn-legit" onclick="submitAdvanced(true)">‚úÖ LEGITIMATE</button>
                        <button class="btn-verdict btn-mal" onclick="submitAdvanced(false)">‚ùå MALICIOUS</button>
                    </div>
                </div>
                
                <!-- Zero Trust Verification Panel (Initially Hidden) -->
                <div id="zero-trust-panel" style="display: none;">
                    <div style="color: var(--accent-teal); font-family: var(--font-code); font-size: 0.8rem; margin-bottom: 10px;">ZERO TRUST PROTOCOL</div>
                    <p style="font-size: 0.85rem; margin-bottom: 15px;">Verify indicators before verdict:</p>
                    
                    <div class="checklist-item" onclick="toggleCheck(this)">
                        <div class="check-box"></div>
                        <div style="font-size: 0.8rem;">Verified LinkedIn Profile</div>
                    </div>
                    <div class="checklist-item" onclick="toggleCheck(this)">
                        <div class="check-box"></div>
                        <div style="font-size: 0.8rem;">Checked Email Domain</div>
                    </div>
                    <div class="checklist-item" onclick="toggleCheck(this)">
                        <div class="check-box"></div>
                        <div style="font-size: 0.8rem;">Headers/SPF Verified</div>
                    </div>

                    <button class="btn-hero btn-primary" style="width: 100%; margin-top: 10px;" onclick="unlockVerdict()">CONFIRM CHECKS</button>
                </div>
            </div>
        </aside>

        <main class="sim-viewport">
            
            <div id="sim-ceo" class="os-window active">
                <div class="window-bar">
                    <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                    <div class="address-bar">üîí mail.corp-internal.net</div>
                </div>
                <div class="email-body">
                    <div class="email-meta">
                        <h2 style="font-size: 1.4rem; margin-bottom: 10px;">URGENT: Wire Transfer Required</h2>
                        <div style="font-size: 0.9rem;"><strong>From:</strong> <span class="sender-tag">e.musk@tesla-motors.com</span><br><strong style="color: #64748b">To:</strong> <span class="user-target">You</span> (Finance Dept)</div>
                    </div>
                    <div style="font-family: serif; font-size: 1.1rem; line-height: 1.6;">
                        <p style="margin-bottom: 15px;">Hi <span class="user-target">there</span>,</p>
                        <p style="margin-bottom: 15px;">I'm currently stuck in a meeting with partners in Tokyo and my company card is being declined. This is embarrassing and critical for the acquisition deal.</p>
                        <p style="margin-bottom: 15px;">Process an immediate wire transfer of <strong>$14,500</strong> to the vendor account attached below. Do not discuss this with anyone yet as the deal is under NDA.</p>
                        <p style="margin-bottom: 20px;">Process this NOW. I will sign paperwork when I land.</p>
                        <p style="font-style: italic; color: #64748b;">Sent from my iPhone</p>
                    </div>
                </div>
            </div>

            <div id="sim-it" class="os-window">
                <div class="window-bar">
                    <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                    <div class="address-bar"># slack-internal</div>
                </div>
                <div class="chat-body">
                    <div class="chat-row"><div class="avatar">ü¶Ñ</div><div class="bubble"><span class="msg-name">SysAdmin_Helpdesk</span>Hi <span class="user-target">there</span>. We've detected a critical syncing error with your Active Directory profile. It looks like your account is flagging 403 errors on the main server.</div></div>
                    <div class="chat-row"><div class="avatar">ü¶Ñ</div><div class="bubble"><span class="msg-name">SysAdmin_Helpdesk</span>We need to re-authenticate your session token manually to prevent a lockout. <span style="color: #f87171; font-weight: bold;">Please reply with your current temporary 2FA code</span> so I can resync the database.</div></div>
                    <div style="color: var(--primary); font-size: 0.8rem; font-family: var(--font-code);">SysAdmin_Helpdesk is typing...</div>
                </div>
            </div>

            <div id="sim-job" class="os-window">
                <div class="window-bar">
                    <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                    <div class="address-bar">üîí linkedin.com/inbox</div>
                </div>
                <div class="email-body" style="border-top: 4px solid #0a66c2;">
                    <div class="email-meta" style="border-bottom: none;">
                        <h2 style="font-size: 1.2rem; margin-bottom: 5px;">Lead Security Architect (Remote)</h2>
                        <div style="font-size: 0.85rem; color: #64748b;">From: Sarah J. (Tech Recruiter at Gooogle)</div>
                    </div>
                    <p style="font-size: 0.9rem; line-height: 1.5; margin-bottom: 15px;">Hey <span class="user-target">there</span>! I stumbled upon your profile and I'm blown away. We have a confidential opening that fits your skills perfectly. Pays 60% above market.</p>
                    <p style="font-size: 0.9rem; line-height: 1.5; margin-bottom: 15px;">We are closing applications <strong>tonight</strong>. I've attached the full compensation breakdown and role details below.</p>
                    <div style="background: #f1f5f9; padding: 10px; border-radius: 6px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px; font-weight: 600; color: #0f172a;">üìÑ Compensation_Pkg_Macro_Enabled.doc</div>
                </div>
            </div>

            <div id="sim-wsp" class="os-window">
                <div class="window-bar" style="background: #202c33; border-bottom: none;">
                    <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                    <div class="address-bar" style="background: #111b21; color: #aebac1;">web.whatsapp.com</div>
                </div>
                <div class="wsp-header">
                    <div class="wsp-avatar">üè¢</div>
                    <div><div style="font-weight: 600; font-size: 0.95rem;">Global Suppliers Inc. (Alex)</div><div style="font-size: 0.75rem; color: #8696a0;">online</div></div>
                </div>
                <div class="wsp-body">
                    <div class="wsp-msg wsp-in">Hey <span class="user-target">Tom</span>! üëã Hope you're having a good week. Just wanted to flag something about Invoice #9092 for the server racks.<div class="wsp-time">10:15 AM</div></div>
                    <div class="wsp-msg wsp-out">Hi Alex. What's the issue? We scheduled that for payment this Friday.<div class="wsp-time">10:18 AM</div></div>
                    <div class="wsp-msg wsp-in">Yeah, that's the thing. Our corporate audit froze our main USD account this morning. Bureaucracy üôÑ<div class="wsp-time">10:20 AM</div></div>
                    <div class="wsp-msg wsp-in">Can you reroute the payment to our subsidiary's account in Singapore? I'll send the new IBAN now. Needs to go out today or shipping gets delayed 2 weeks. üò¨<div class="wsp-time">10:20 AM</div></div>
                </div>
            </div>

            <div id="sim-gov_ato" class="phone-mockup">
                <div class="phone-screen">
                    <div class="phone-overlay"></div>
                    <div class="sms-popup">
                        <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#666; margin-bottom:5px;"><span>MESSAGES</span> <span>now</span></div>
                        <div style="font-size:0.9rem;"><strong>WhatsApp:</strong> Your verification code is 449-120. Do not share this with anyone.</div>
                    </div>
                    <div class="call-ui">
                        <div class="caller-avatar">üèõÔ∏è</div>
                        <div style="font-size:1.5rem; font-weight:600;">Ministerio de Salud</div>
                        <div style="opacity:0.8;">Mobile +54 9 11...</div>
                        <p style="margin-top: 30px; font-size: 0.9rem; padding: 0 30px; font-style: italic;">"Hola <span class="user-target"></span>, le llamamos por su turno de vacunaci√≥n. Le enviamos un c√≥digo SMS para confirmar identidad..."</p>
                        <div style="display: flex; gap: 40px; justify-content: center; margin-top: 60px;">
                            <div style="width: 60px; height: 60px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìû</div>
                            <div style="width: 60px; height: 60px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìû</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sim-mfa_fatigue" class="phone-mockup">
                <div class="phone-screen" style="background-color: #111; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">üîí</div>
                    <h2 style="margin-bottom: 20px; color:white;">Authenticator</h2>
                    <div style="background: #333; padding: 20px; border-radius: 12px; width:80%; margin-bottom: 10px; animation: shake 0.5s; color:white;">
                        <h3>Approve sign-in?</h3>
                        <p style="color: #aaa; font-size: 0.8rem; margin:5px 0 15px 0;">Azure AD ‚Ä¢ California, US</p>
                        <div style="display: flex; gap: 10px;">
                            <button style="flex:1; padding: 10px; background: #444; border:none; color: white; border-radius: 4px;">Deny</button>
                            <button style="flex:1; padding: 10px; background: var(--primary); border:none; color: white; border-radius: 4px;">Approve</button>
                        </div>
                    </div>
                    <div style="background: #333; padding: 20px; border-radius: 12px; width:80%; opacity: 0.5; transform: scale(0.95); color:white;">
                        <h3>Approve sign-in?</h3>
                    </div>
                </div>
            </div>

            <!-- RECRUITMENT CHALLENGE CONTAINER -->
            <div id="sim-recruitment" style="display: none; width: 100%; height: 100%; justify-content: center; align-items: center; position: relative;">
                
                <div class="btn-switch-view" onclick="toggleRecruitmentView()">
                    <span>üîÑ</span> Switch Device
                </div>

                <!-- Part 1: WhatsApp -->
                <div id="sim-recruitment-phone" class="phone-mockup" style="display: block;">
                    <div class="phone-screen">
                        <div class="phone-overlay"></div>
                        <div style="background: #075e54; height: 80px; padding: 40px 20px 10px; color: white; display: flex; align-items: center; gap: 15px;">
                            <div style="width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #075e54; font-weight: bold;">E</div>
                            <div>
                                <div style="font-weight: 600;">Elena (TechFlow HR)</div>
                                <div style="font-size: 0.7rem; opacity: 0.8;">Online</div>
                            </div>
                        </div>
                        <div style="padding: 20px; background: #e5ddd5; height: calc(100% - 80px); display: flex; flex-direction: column; gap: 10px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');">
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">Hi <span class="user-target">Tom</span>! üëã I'm Elena from TechFlow. I saw your profile on LinkedIn and it's exactly what we are looking for.<div class="wsp-time">09:30 AM</div></div>
                            <div class="wsp-msg wsp-out" style="background: #dcf8c6; color: black; align-self: flex-end;">Hi Elena. Thanks for reaching out. What role is this for?<div class="wsp-time">09:35 AM</div></div>
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">It's for the Senior SecOps Lead. Fully remote, $140k/yr + equity. üöÄ<div class="wsp-time">09:36 AM</div></div>
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">I just sent the formal offer letter and benefits package to your email address. Let me know when you receive it!<div class="wsp-time">09:37 AM</div></div>
                        </div>
                    </div>
                </div>

                <!-- Part 2: Email -->
                <div id="sim-recruitment-email" class="os-window" style="display: none;">
                    <div class="window-bar">
                        <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                        <div class="address-bar">üîí mail.google.com</div>
                    </div>
                    <div class="email-body">
                        <div class="email-meta">
                            <h2 style="font-size: 1.4rem; margin-bottom: 10px;">Official Offer: Senior Security Operations Lead</h2>
                            <div style="font-size: 0.9rem;">
                                <strong>From:</strong> <span class="sender-tag" style="background: #d1fae5; color: #065f46;">elena.gomez@techflow.io</span> ‚úÖ<br>
                                <strong style="color: #64748b">To:</strong> <span class="user-target-email">tom.doe</span>@gmail.com
                            </div>
                            <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 5px;">
                                Security: Standard encryption (TLS) ‚Ä¢ Signed by: techflow.io
                            </div>
                        </div>
                        <div style="font-family: sans-serif; font-size: 1rem; line-height: 1.6; color: #334155;">
                            <p style="margin-bottom: 15px;">Dear <span class="user-target">Tom</span>,</p>
                            <p style="margin-bottom: 15px;">Following our conversation, we are thrilled to offer you the position of <strong>Senior SecOps Lead</strong> at TechFlow Inc.</p>
                            <p style="margin-bottom: 15px;">Attached you will find the formal offer letter outlining the compensation package, equity details, and benefits.</p>
                            <p style="margin-bottom: 20px;">We are excited to have you join the team!</p>
                            
                            <div style="background: #f1f5f9; padding: 15px; border-radius: 6px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 2rem;">üìÑ</div>
                                <div>
                                    <div style="font-weight: 700; color: #0f172a;">TechFlow_Offer_Letter_<span class="user-initials">TD</span>.pdf</div>
                                    <div style="font-size: 0.8rem; color: #64748b;">1.2 MB ‚Ä¢ No threats detected</div>
                                </div>
                            </div>

                            <p style="margin-top: 20px; font-style: italic; color: #64748b;">
                                Best regards,<br>
                                Elena Gomez<br>
                                HR Director | TechFlow Inc.
                            </p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- NEW MULTI-STAGE ATTACK CONTAINER -->
            <div id="sim-multistage" style="display: none; width: 100%; height: 100%; justify-content: center; align-items: center; position: relative;">
                
                <div class="timeline-controls">
                    <button class="btn-timeline" onclick="changeStage(0)">‚óÄ</button>
                    <div class="timeline-dot active" onclick="changeStage(0)"></div>
                    <div class="timeline-dot" onclick="changeStage(1)"></div>
                    <div class="timeline-dot" onclick="changeStage(2)"></div>
                    <div class="timeline-dot" onclick="changeStage(3)"></div>
                    <div class="timeline-dot" onclick="changeStage(4)"></div>
                    <button class="btn-timeline" onclick="changeStage('next')">‚ñ∂</button>
                </div>

                <!-- STAGE 1: EMAIL -->
                <div id="stage-0" class="os-window active">
                    <div class="window-bar">
                        <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                        <div class="address-bar">üîí outlook.office365.com</div>
                    </div>
                    <div class="email-body">
                        <div class="email-meta">
                            <h2 style="font-size: 1.4rem; margin-bottom: 10px; color: #d93025;">Actualizaci√≥n urgente de beneficios ‚Äì Acci√≥n requerida hoy</h2>
                            <div style="font-size: 0.9rem;">
                                <strong>From:</strong> <span class="sender-tag" style="background: #fef2f2; color: #991b1b;">maria.torres@tech-nova-hr.com</span> ‚ö†Ô∏è<br>
                                <strong style="color: #64748b">To:</strong> <span class="user-target-email">tom.doe</span>@technova.com
                            </div>
                        </div>
                        <div style="font-family: sans-serif; font-size: 1rem; line-height: 1.6; color: #334155;">
                            <p>Hola <span class="user-target">Tom</span>,</p>
                            <p>Por una actualizaci√≥n en la plataforma de beneficios 2025 debes revisar tu informaci√≥n antes de las 12:00.</p>
                            <p>Accede aqu√≠:</p>
                            <a href="#" style="display: block; padding: 10px; background: #2563eb; color: white; text-align: center; border-radius: 4px; text-decoration: none; margin: 20px 0;">üëâ https://tecnova-benefits-secure.com/update</a>
                            <p style="font-size: 0.9rem; color: #d93025;">Si no completas el formulario podr√≠as quedar temporalmente sin cobertura m√©dica.</p>
                            <p style="margin-top: 20px; color: #64748b;">‚Äì Mar√≠a Torres, RRHH</p>
                        </div>
                    </div>
                </div>

                <!-- STAGE 2: WHATSAPP -->
                <div id="stage-1" class="phone-mockup" style="display: none;">
                    <div class="phone-screen">
                        <div class="phone-overlay"></div>
                        <div style="background: #075e54; height: 80px; padding: 40px 20px 10px; color: white; display: flex; align-items: center; gap: 15px;">
                            <div style="width: 35px; height: 35px; background: #128c7e; border-radius: 50%; display: flex; align-items: center; justify-content: center;">üíª</div>
                            <div>
                                <div style="font-weight: 600;">Carlos - Soporte TI</div>
                                <div style="font-size: 0.7rem; opacity: 0.8;">Online</div>
                            </div>
                        </div>
                        <div style="padding: 20px; background: #e5ddd5; height: calc(100% - 80px); display: flex; flex-direction: column; gap: 10px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');">
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">Hola! Soy Carlos de TI. Notamos que tu sesi√≥n en Outlook ha tenido actividad inusual.</div>
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">¬øRecibiste un correo de RRHH hoy?</div>
                            <div class="wsp-msg wsp-in" style="background: white; color: black; align-self: flex-start;">Si s√≠, necesito validar tu identidad para evitar que bloqueen tu cuenta. Env√≠ame por favor el c√≥digo que te llegar√° por SMS.</div>
                            <div class="sms-popup" style="animation: slideDown 0.5s forwards; opacity: 1; transform: translateY(0); top: 120px;">
                                <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#666; margin-bottom:5px;"><span>Microsoft</span> <span>now</span></div>
                                <div style="font-size:0.9rem;">Use code 882910 for Microsoft authentication.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 3: CALL -->
                <div id="stage-2" class="phone-mockup" style="display: none;">
                    <div class="phone-screen" style="background: radial-gradient(circle at center, #1f2937, #000);">
                        <div style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 60px 20px;">
                            <div style="text-align: center; color: white;">
                                <div style="width: 100px; height: 100px; background: #374151; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px;">üõ°Ô∏è</div>
                                <h2 style="font-size: 1.8rem; font-weight: 400; margin-bottom: 5px;">Ana Robles</h2>
                                <p style="color: #9ca3af;">Seguridad Interna</p>
                                <p style="color: #4ade80; margin-top: 10px;">04:12</p>
                            </div>
                            <div style="width: 100%; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; color: #e5e7eb; font-size: 0.9rem; font-style: italic;">
                                "Hola, te llamo porque tu cuenta aparece vinculada a un movimiento sospechoso desde Argentina. Necesito confirmar tu ID de empleado y modelo de equipo para evitar suspensi√≥n..."
                            </div>
                            <div style="display: flex; gap: 40px;">
                                <div style="width: 65px; height: 65px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üé§</div>
                                <div style="width: 65px; height: 65px; background: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer;">üìû</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 4: FAKE AV -->
                <div id="stage-3" class="os-window" style="display: none; height: 100%; background: url('https://images.unsplash.com/photo-1629654297299-c8506221ca97?q=80&w=2574&auto=format&fit=crop') center/cover;">
                    <div class="fake-av-overlay">
                        <div class="fake-av-window">
                            <div class="av-header">
                                <span>üõ°Ô∏è Windows Defender Security Center</span>
                            </div>
                            <div style="padding: 30px; text-align: center;">
                                <div style="font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
                                <h2 style="margin-bottom: 10px;">Threat Detected!</h2>
                                <p style="margin-bottom: 20px; color: #444;">Se detect√≥ actividad maliciosa proveniente de su cuenta. Trojan.Win32.Generic</p>
                                <button style="background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer;">Descargar herramienta de reparaci√≥n (Fix-Security2025.exe)</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 5: SLACK -->
                <div id="stage-4" class="os-window" style="display: none;">
                    <div class="window-bar">
                        <div class="traffic-light tl-red"></div><div class="traffic-light tl-yellow"></div><div class="traffic-light tl-green"></div>
                        <div class="address-bar"># general - Slack</div>
                    </div>
                    <div class="chat-body" style="background: #1a1d21; height: 100%;">
                        <div class="chat-row" style="align-items: flex-start;">
                            <div class="avatar" style="background: #e01e5a; min-width: 40px;">L</div>
                            <div style="display: flex; flex-direction: column; width: 100%;">
                                <div style="display: flex; align-items: baseline; gap: 10px; margin-bottom: 5px;">
                                    <span style="color: white; font-weight: bold;">Luis (IT Support)</span>
                                    <span style="color: #9ca3af; font-size: 0.75rem;">11:45 AM</span>
                                </div>
                                <div style="color: #d1d5db; font-size: 0.95rem; line-height: 1.5;">
                                    Oye, ¬øt√∫ tambi√©n recibiste lo de RRHH? Yo ya valid√© con Carlos de TI. Todo est√° bien. üëç Ellos solo est√°n actualizando sistemas.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        
        <div class="modal-card" id="modal-defense">
            <div class="modal-header">
                <h3 style="color: var(--accent-gold)">‚ö†Ô∏è THREAT IDENTIFIED. INITIATE COUNTERMEASURE.</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; font-size: 1.1rem;">You have correctly identified the attack vector. How do you proceed? Select the most secure response.</p>
                <div class="defense-options" id="defense-options-container">
                    </div>
            </div>
        </div>

        <div class="modal-card" id="modal-analysis">
            <div class="modal-header">
                <h3 style="color: var(--primary)">üõ°Ô∏è MISSION DEBRIEF & ANALYSIS</h3>
                <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="coach-grid">
                    <div class="coach-box">
                        <span class="coach-label">ATTACK TECHNIQUE (CIALDINI)</span>
                        <div id="coach-tech">...</div>
                    </div>
                    <div class="coach-box">
                        <span class="coach-label">LINGUISTIC TRIGGERS (VRIJ)</span>
                        <div id="coach-ling">...</div>
                    </div>
                </div>
                <div class="coach-box" style="margin-top: 20px; border-left: 3px solid var(--accent-green);">
                    <span class="coach-label" style="color: var(--accent-green)">CORRECT DEFENSIVE PROTOCOL</span>
                    <div id="coach-proto">...</div>
                </div>
                <div style="margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);">
                    <strong>Why you succeeded:</strong> <span id="coach-why"></span>
                </div>
                <button class="btn-hero btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeModal()">RETURN TO LAB</button>
            </div>
        </div>

    </div>

    <div id="toast" class="toast">
        <div style="font-size: 2rem;" id="toast-icon">‚úÖ</div>
        <div>
            <h3 style="margin-bottom: 5px;" id="toast-title">Success</h3>
            <p style="font-size: 0.9rem; color: var(--text-muted);" id="toast-msg">Vector correctly identified.</p>
        </div>
    </div>

    <script>
        // --- ONBOARDING & PERSONALIZATION LOGIC ---
        let currentUser = localStorage.getItem('operatorAlias') || "Operator";

        function handleEnter(e) {
            if(e.key === 'Enter') completeOnboarding();
        }

        function completeOnboarding() {
            const input = document.getElementById('username-input');
            const name = input.value.trim();
            
            if(name) {
                currentUser = name;
                localStorage.setItem('operatorAlias', currentUser);
                updatePersonalization();
                document.getElementById('onboarding-modal').style.display = 'none';
            } else {
                input.style.border = "1px solid var(--accent-red)";
                input.placeholder = "IDENTITY REQUIRED...";
            }
        }

        function updatePersonalization() {
            // Update Simulation Targets
            document.querySelectorAll('.user-target').forEach(el => {
                el.innerText = currentUser;
            });
            
            // Update Email Targets (Lower case)
            document.querySelectorAll('.user-target-email').forEach(el => {
                el.innerText = currentUser.toLowerCase().replace(/\s/g, '.');
            });

            // Update Initials in PDF
            const initials = currentUser.split(" ").map((n)=>n[0]).join("").toUpperCase().substring(0,2);
            document.querySelectorAll('.user-initials').forEach(el => {
                el.innerText = initials;
            });
        }

        // Check if user already exists on load
        window.addEventListener('load', () => {
            if(localStorage.getItem('operatorAlias')) {
                currentUser = localStorage.getItem('operatorAlias');
                updatePersonalization();
                document.getElementById('onboarding-modal').style.display = 'none';
            } else {
                // Focus input automatically
                setTimeout(() => document.getElementById('username-input').focus(), 500);
            }
        });


        // --- MATRIX EFFECT ---
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$#@%&';
        const fontSize = 14; const columns = canvas.width / fontSize; const drops = Array(Math.floor(columns)).fill(1);
        function draw() {
            ctx.fillStyle = 'rgba(2, 6, 23, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0f0'; ctx.font = fontSize + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0; drops[i]++;
            }
        }
        setInterval(draw, 33);

        // --- NAVIGATION ---
        function navTo(viewId) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId + '-view').classList.add('active');
            document.querySelectorAll('.nav-links button').forEach(btn => btn.classList.remove('active'));
            // Find the button that called this, if available, otherwise manual check
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }

            // Typing effect trigger for profile
            if(viewId === 'profile') {
                const text = "DECRYPTING...";
                const el = document.getElementById('typing-text');
                el.innerText = "";
                let i = 0;
                const type = () => {
                    if (i < text.length) {
                        el.innerText += text.charAt(i);
                        i++;
                        setTimeout(type, 100);
                    }
                }
                type();
            }
        }

        // --- SIMULATOR TABS LOGIC (Added from Code 2) ---
        function switchTab(mode) {
            document.querySelectorAll('.sim-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('list-basic').className = mode === 'basic' ? 'sc-list visible' : 'sc-list';
            document.getElementById('list-advanced').className = mode === 'advanced' ? 'sc-list visible' : 'sc-list';
            
            // Toggle panels
            document.getElementById('panel-analysis').className = mode === 'basic' ? 'control-panel visible' : 'control-panel';
            document.getElementById('panel-verdict').className = mode === 'advanced' ? 'control-panel visible' : 'control-panel';
        }

        // --- DATA: EDUCATIONAL CONTENT ---
        const scenarioData = {
            'ceo': {
                defensiveOptions: [
                    { text: "Reply immediately apologizing and asking for the account number again.", correct: false },
                    { text: "Call the CEO's Executive Assistant (EA) on a known internal line to verify.", correct: true },
                    { text: "Forward the email to the vendor to check if they are real.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Authority & Scarcity:</strong> The attacker poses as a high-level executive to bypass scrutiny and claims to be 'unavailable' (in a meeting) to prevent voice verification.",
                    ling: "Use of <strong>Imperative Language</strong> ('Process this NOW') and <strong>Isolation</strong> ('Do not discuss this with anyone'). High pressure tactics designed to induce cognitive tunneling.",
                    proto: "<strong>Verify Out-of-Band:</strong> Never process financial requests based solely on email. Call a known number (not one in the email) or use internal chat to verify identity.",
                    why: "You refused to let rank override security protocols. Hybris punished."
                }
            },
            'it': {
                defensiveOptions: [
                    { text: "Provide the 2FA code quickly to avoid the server lockout.", correct: false },
                    { text: "Ask: 'What is the Ticket ID for this incident?' and verify in the portal.", correct: true },
                    { text: "Argue with them that your account is working fine.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Quid Pro Quo & Fear:</strong> Offering a service (fixing the error) in exchange for information (2FA token). Exploits fear of losing access.",
                    ling: "<strong>Technobabble:</strong> Using terms like '403 errors', 'Active Directory', and 'resync' to overwhelm the victim and appear legitimate.",
                    proto: "<strong>Zero Trust:</strong> IT Support will NEVER ask for your password or 2FA code. If they do, it's a Red Team test or a real attack. Report immediately.",
                    why: "You challenged the source instead of complying with fear."
                }
            },
            'job': {
                defensiveOptions: [
                    { text: "Download the file to check the salary range, then delete it.", correct: false },
                    { text: "Respond asking for the job description in the text body, not an attachment.", correct: true },
                    { text: "Accept the interview request immediately.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Curiosity & Greed:</strong> Leveraging a high-salary offer and 'confidential' info to trick you into executing a payload (Macro-enabled Doc).",
                    ling: "<strong>Flattery:</strong> 'Blown away by your profile'. <strong>Artificial Deadline:</strong> 'Closing tonight'. Both are designed to bypass logical analysis.",
                    proto: "<strong>Sandboxing:</strong> Never open unsolicited attachments, especially macro-enabled ones (.docm, .xlsm), even from 'recruiters'. Verify the role on the company site.",
                    why: "You recognized that if it looks too good to be true, it's bait."
                }
            },
            'wsp': {
                defensiveOptions: [
                    { text: "Change the IBAN immediately to ensure shipping isn't delayed.", correct: false },
                    { text: "Reply: 'I need to verify this change via official email/call with your Finance Controller.'", correct: true },
                    { text: "Ask Alex how his vacation was to see if it's really him.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Rapport & Urgency:</strong> Using a known contact (Alex) and a casual channel (WhatsApp) to bypass formal change management controls.",
                    ling: "<strong>Casual Mimicry:</strong> Use of emojis and casual greeting ('Hey Tom!') mixed with a business crisis ('frozen account').",
                    proto: "<strong>Dual-Control:</strong> Bank account changes require verification via a second channel and approval from a second internal person. Never trust IM for payments.",
                    why: "You separated the relationship from the transaction."
                }
            },
            // --- ADVANCED SCENARIOS (Merged & Normalized to Code 1 Format) ---
            'gov_ato': {
                isMalicious: true, // Specific for Advanced Logic
                defensiveOptions: [
                    { text: "Read the code to the caller.", correct: false },
                    { text: "Hang up immediately.", correct: true },
                    { text: "Ask for their badge number.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Authority (Gov) & Urgency:</strong> The 'Vaccine/Health' call is a pretext. The code sent is for <strong>WhatsApp Registration</strong> (ATO - Account Takeover).",
                    ling: "<strong>Context Switching:</strong> Mixing a verbal 'Health' context with a digital 'WhatsApp' notification code to confuse the victim.",
                    proto: "<strong>Never Share OTPs:</strong> No legitimate organization asks for a code sent to your phone. It grants account takeover instantly.",
                    why: "You identified the disparity between the caller's claim and the SMS content."
                }
            },
            'mfa_fatigue': {
                isMalicious: true, // Specific for Advanced Logic
                defensiveOptions: [
                    { text: "Approve to stop the noise.", correct: false },
                    { text: "Report Account Compromise immediately.", correct: true },
                    { text: "Turn off the phone.", correct: false }
                ],
                analysis: {
                    tech: "<strong>MFA Fatigue / Exhaustion:</strong> Flooding the victim with prompts hoping they click 'Approve' out of frustration or habit.",
                    ling: "N/A (System Notification). The psychological trigger is <strong>Annoyance</strong> and <strong>Normalization</strong>.",
                    proto: "<strong>Deny & Report:</strong> If you didn't trigger the login, someone has your password. Change it immediately.",
                    why: "You withstood the pressure to silence the device and reported the breach."
                }
            },
            'recruitment': {
                isMalicious: false, // IT IS LEGITIMATE
                defensiveOptions: [
                    { text: "Reply asking for a higher salary.", correct: false },
                    { text: "Schedule an onboarding call with HR.", correct: true },
                    { text: "Report as phishing.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Channel Hopping:</strong> Attackers often start on LinkedIn/WhatsApp and move to Email to build legitimacy. However, in this case, the <strong>DKIM/SPF Headers</strong> and domain were valid.",
                    ling: "The offer was consistent with the initial conversation. No urgency, no macros in the PDF, no credential harvesting links.",
                    proto: "<strong>Trust but Verify:</strong> You performed the correct checks (LinkedIn, Domain, Headers) and confirmed it was a real offer. Zero Trust doesn't mean Zero Business.",
                    why: "You verified the evidence instead of succumbing to paranoia."
                }
            },
            'multistage': {
                isMalicious: true, // MULTI-VECTOR APT
                defensiveOptions: [
                    { text: "Trust Luis (Slack) since he is a known colleague.", correct: false },
                    { text: "Report the entire chain to Security Operations Center (SOC).", correct: true },
                    { text: "Download the fix tool but scan it with another AV.", correct: false }
                ],
                analysis: {
                    tech: "<strong>Advanced Persistent Threat (APT):</strong> This simulation mimics a complex attack chain: 1. Credential Harvesting (Email), 2. MFA Bypass (WhatsApp/Call), 3. Malware Delivery (Fake AV), 4. Persistence via Compromised Internal Account (Slack).",
                    ling: "<strong>Sound Boarding & Social Proof:</strong> The attackers used multiple identities to validate each other ('Carlos sent me', 'Luis confirmed it'). This creates a 'Bubble of Trust'.",
                    proto: "<strong>Out-of-Band Verification:</strong> When multiple independent channels push the same urgent narrative, it is likely a coordinated attack. Never download 'fixes' from pop-ups. Verify status with the real Helpdesk via a clean channel.",
                    why: "You recognized the orchestrated nature of the campaign despite the social proof."
                }
            }
        };

        // --- SIMULATOR LOGIC ---
        let currentSim = 'ceo';
        let currentStage = 0;

        function loadSim(simId, mode) {
            currentSim = simId;
            document.querySelectorAll('.scenario-item').forEach(el => el.classList.remove('active'));
            document.getElementById('btn-' + simId).classList.add('active');
            
            // Hide all windows (both Code 1 OS windows and Code 2 Phones)
            document.querySelectorAll('.os-window, .phone-mockup').forEach(el => el.classList.remove('active'));
            document.getElementById('sim-recruitment').style.display = 'none'; 
            document.getElementById('sim-multistage').style.display = 'none';
            
            // Show target
            if (simId === 'recruitment') {
                document.getElementById('sim-recruitment').style.display = 'flex';
                // Reset recruitment view to phone
                document.getElementById('sim-recruitment-phone').style.display = 'block';
                document.getElementById('sim-recruitment-email').style.display = 'none';
                
                // Show Zero Trust Panel instead of buttons initially
                document.getElementById('verdict-buttons-container').style.display = 'none';
                document.getElementById('zero-trust-panel').style.display = 'block';
            } 
            else if (simId === 'multistage') {
                document.getElementById('sim-multistage').style.display = 'flex';
                currentStage = 0;
                updateStageDisplay();
                // Show standard verdict buttons
                document.getElementById('verdict-buttons-container').style.display = 'block';
                document.getElementById('zero-trust-panel').style.display = 'none';
            }
            else {
                document.getElementById('sim-' + simId).classList.add('active');
                
                // Show standard verdict buttons
                document.getElementById('verdict-buttons-container').style.display = 'block';
                document.getElementById('zero-trust-panel').style.display = 'none';
            }
            
            // Reset selectors
            document.getElementById('analysis-select').value = "";
        }

        // LOGIC FOR MULTI-STAGE CHALLENGE
        function changeStage(target) {
            if (target === 'next') {
                if (currentStage < 4) currentStage++;
            } else {
                currentStage = target;
            }
            updateStageDisplay();
        }

        function updateStageDisplay() {
            // Hide all stages inside multistage container
            for (let i = 0; i <= 4; i++) {
                const el = document.getElementById('stage-' + i);
                if (el) el.style.display = 'none';
                // Reset active class on dots
                document.querySelectorAll('.timeline-dot')[i].classList.remove('active');
            }
            
            // Show current
            const currentEl = document.getElementById('stage-' + currentStage);
            if (currentEl) {
                currentEl.style.display = 'block';
                currentEl.classList.add('active'); // Ensure OS windows get the popIn animation if applicable
            }
            document.querySelectorAll('.timeline-dot')[currentStage].classList.add('active');
        }

        // SPECIFIC LOGIC FOR RECRUITMENT CHALLENGE
        function toggleRecruitmentView() {
            const phone = document.getElementById('sim-recruitment-phone');
            const email = document.getElementById('sim-recruitment-email');
            
            if (phone.style.display !== 'none') {
                phone.style.display = 'none';
                email.style.display = 'block';
                email.classList.add('active');
            } else {
                phone.style.display = 'block';
                email.style.display = 'none';
                email.classList.remove('active');
            }
        }

        function toggleCheck(el) {
            el.classList.toggle('checked');
        }

        function unlockVerdict() {
            const checks = document.querySelectorAll('.checklist-item.checked');
            if (checks.length < 3) {
                showToast("Perform all checks before deciding.", "error");
                return;
            }
            
            // Show verification success and reveal buttons
            showToast("Zero Trust Protocol Verified.", "success");
            setTimeout(() => {
                document.getElementById('zero-trust-panel').style.display = 'none';
                document.getElementById('verdict-buttons-container').style.display = 'block';
                // Reset checks for next time
                document.querySelectorAll('.checklist-item').forEach(el => el.classList.remove('checked'));
            }, 1000);
        }

        // BASIC MODE SUBMISSION (Code 1 Logic)
        function submitAnalysis() {
            const val = document.getElementById('analysis-select').value;
            
            let correct = false;
            if (currentSim === 'ceo' && (val === 'authority' || val === 'urgency')) correct = true;
            if (currentSim === 'it' && (val === 'urgency' || val === 'quidproquo')) correct = true;
            if (currentSim === 'job' && (val === 'scarcity' || val === 'curiosity')) correct = true;
            if (currentSim === 'wsp' && (val === 'urgency' || val === 'rapport')) correct = true;
            if (currentSim === 'multistage' && val === 'multivector') correct = true; // Allow explicit multi-vector selection

            if (correct) {
                showToast("Analysis Verified. Initiating Countermeasures...", "success");
                setTimeout(() => openDefenseModal(), 1500);
            } else {
                showToast("Analysis Failed. Review the indicators.", "error");
            }
        }

        // ADVANCED MODE SUBMISSION (Code 2 Logic adapted to Code 1 UI)
        function submitAdvanced(userSaysLegit) {
            const data = scenarioData[currentSim];
            const userSaysMalicious = !userSaysLegit;
            
            if (data.isMalicious === userSaysMalicious) {
                showToast("Threat Verified. Initiating Countermeasures...", "success");
                setTimeout(() => openDefenseModal(), 1500);
            } else {
                showToast("Wrong Verdict. System Compromised.", "error");
            }
        }

        function showToast(text, type) {
            const toast = document.getElementById('toast');
            const title = document.getElementById('toast-title');
            const msg = document.getElementById('toast-msg');
            const icon = document.getElementById('toast-icon');

            toast.className = type === "success" ? "toast show" : "toast show error";
            title.innerText = type === "success" ? "THREAT IDENTIFIED" : "SYSTEM ALERT";
            title.style.color = type === "success" ? "var(--accent-green)" : "var(--accent-red)";
            msg.innerText = text;
            icon.innerText = type === "success" ? "üõ°Ô∏è" : "‚ùå";
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // --- MODAL LOGIC (Shared) ---
        function openDefenseModal() {
            const data = scenarioData[currentSim];
            const container = document.getElementById('defense-options-container');
            container.innerHTML = '';

            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('modal-defense').style.display = 'block';
            document.getElementById('modal-analysis').style.display = 'none';

            data.defensiveOptions.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = 'def-btn';
                btn.innerHTML = `<span class="def-icon">üí¨</span> ${opt.text}`;
                btn.onclick = () => checkDefenseChoice(index);
                container.appendChild(btn);
            });
        }

        function checkDefenseChoice(index) {
            const data = scenarioData[currentSim];
            if (data.defensiveOptions[index].correct) {
                // Correct Defense -> Show Coach
                document.getElementById('modal-defense').style.display = 'none';
                document.getElementById('modal-analysis').style.display = 'block';
                
                // Populate Coach
                document.getElementById('coach-tech').innerHTML = data.analysis.tech;
                document.getElementById('coach-ling').innerHTML = data.analysis.ling;
                document.getElementById('coach-proto').innerHTML = data.analysis.proto;
                document.getElementById('coach-why').innerText = data.analysis.why;
            } else {
                showToast("Ineffective Defense. The attacker bypassed you.", "error");
            }
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

    </script>
</body>
</html>
